# Развертывание платформы в локальной сети

Эта инструкция поможет развернуть платформу так, чтобы другие пользователи в вашей локальной сети могли получить к ней доступ.

## Шаг 1: Узнайте свой локальный IP-адрес

1. Откройте командную строку (cmd)
2. Выполните команду:
```bash
ipconfig
```
3. Найдите строку **IPv4-адрес** в разделе вашего сетевого адаптера
   - Например: `192.168.1.100` или `192.168.0.50`
   - Запишите этот IP-адрес - он понадобится дальше

## Шаг 2: Настройка Backend

### 2.1 Создайте файл для запуска backend в сети

Создайте новый файл `backend/START_BACKEND_NETWORK.bat` со следующим содержимым:

```batch
@echo off
chcp 65001 >nul
echo ================================================
echo Запуск Backend сервера для локальной сети
echo ================================================
echo.
echo ВАЖНО: Замените YOUR_LOCAL_IP на ваш IP-адрес!
echo Backend будет доступен по адресу: http://YOUR_LOCAL_IP:8000
echo Документация API: http://YOUR_LOCAL_IP:8000/docs
echo.
echo Нажмите Ctrl+C для остановки сервера
echo ================================================
echo.

cd /d "%~dp0"
call venv\Scripts\activate.bat
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**Важно:** `--host 0.0.0.0` позволяет серверу принимать подключения со всех сетевых интерфейсов.

### 2.2 Настройте CORS в backend

Откройте файл `backend/app/main.py` и убедитесь, что CORS настроен правильно:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # В продакшене укажите конкретные адреса
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

## Шаг 3: Настройка Frontend

### 3.1 Создайте файл переменных окружения

Создайте файл `frontend/.env.local` со следующим содержимым:

```env
REACT_APP_API_URL=http://YOUR_LOCAL_IP:8000/api
```

**Замените `YOUR_LOCAL_IP`** на ваш реальный IP-адрес (например, `192.168.1.100`)

Пример:
```env
REACT_APP_API_URL=http://192.168.1.100:8000/api
```

### 3.2 Создайте файл для запуска frontend в сети

Создайте файл `frontend/START_FRONTEND_NETWORK.bat`:

```batch
@echo off
chcp 65001 >nul
echo ================================================
echo Запуск Frontend для локальной сети
echo ================================================
echo.
echo ВАЖНО: Убедитесь что файл .env.local настроен!
echo Frontend будет доступен по адресу: http://YOUR_LOCAL_IP:3000
echo.
echo Нажмите Ctrl+C для остановки сервера
echo ================================================
echo.

set HOST=0.0.0.0
npm start
```

## Шаг 4: Настройка брандмауэра Windows

Необходимо разрешить входящие подключения на порты 3000 и 8000:

### Вариант 1: Через GUI

1. Откройте **Панель управления** → **Брандмауэр Windows** → **Дополнительные параметры**
2. Выберите **Правила для входящих подключений** → **Создать правило**
3. Тип правила: **Для порта**
4. Протокол: **TCP**, Порты: **3000, 8000**
5. Действие: **Разрешить подключение**
6. Профиль: выберите **Частный** и **Доменный**
7. Имя: **Construction Management Platform**

### Вариант 2: Через командную строку (от имени администратора)

```bash
netsh advfirewall firewall add rule name="Construction Backend" dir=in action=allow protocol=TCP localport=8000
netsh advfirewall firewall add rule name="Construction Frontend" dir=in action=allow protocol=TCP localport=3000
```

## Шаг 5: Запуск платформы

### 5.1 Запустите Backend

1. Откройте командную строку
2. Перейдите в папку backend:
```bash
cd backend
```
3. Запустите сервер:
```bash
START_BACKEND_NETWORK.bat
```

Backend будет доступен по адресу: `http://YOUR_LOCAL_IP:8000`

### 5.2 Запустите Frontend

1. Откройте новую командную строку
2. Перейдите в папку frontend:
```bash
cd frontend
```
3. Запустите приложение:
```bash
START_FRONTEND_NETWORK.bat
```

Frontend будет доступен по адресу: `http://YOUR_LOCAL_IP:3000`

## Шаг 6: Доступ с других устройств

Теперь другие пользователи в вашей локальной сети могут открыть браузер и перейти по адресу:

```
http://YOUR_LOCAL_IP:3000
```

Замените `YOUR_LOCAL_IP` на ваш реальный IP-адрес (например, `http://192.168.1.100:3000`)

## Учетные данные по умолчанию

- **Логин:** admin
- **Пароль:** admin123

## Устранение неполадок

### Проблема: Не удается подключиться с другого устройства

**Решение:**
1. Проверьте, что брандмауэр настроен правильно
2. Убедитесь, что оба устройства находятся в одной сети
3. Попробуйте временно отключить брандмауэр для проверки
4. Проверьте, что backend и frontend запущены

### Проблема: Frontend не может подключиться к Backend

**Решение:**
1. Проверьте файл `frontend/.env.local` - IP-адрес должен быть правильным
2. Убедитесь, что backend запущен и доступен по адресу `http://YOUR_LOCAL_IP:8000`
3. Откройте консоль разработчика в браузере (F12) и проверьте ошибки

### Проблема: CORS ошибки

**Решение:**
1. Убедитесь, что в `backend/app/main.py` настроен `allow_origins=["*"]`
2. Перезапустите backend после изменений

## Важные замечания

1. **Безопасность:** Эта конфигурация предназначена для локальной сети. Не используйте её для публичного доступа через интернет без дополнительной настройки безопасности.

2. **Статический IP:** Если ваш IP-адрес меняется, вам нужно будет обновить файл `.env.local` и перезапустить frontend.

3. **Производительность:** Убедитесь, что ваш компьютер имеет достаточно ресурсов для одновременной работы backend и frontend.

4. **База данных:** Все пользователи будут работать с одной базой данных SQLite на вашем компьютере.

## Альтернатива: Использование имени компьютера

Вместо IP-адреса можно использовать имя компьютера:

1. Узнайте имя компьютера:
```bash
hostname
```

2. Используйте его в `.env.local`:
```env
REACT_APP_API_URL=http://YOUR-COMPUTER-NAME:8000/api
```

3. Доступ с других устройств:
```
http://YOUR-COMPUTER-NAME:3000
```

Это работает, если в вашей сети настроено разрешение имен (обычно работает в корпоративных сетях).
